# 模块

## commonjs

1. 在 commonjs 中, module.exports 等价于 exports，注意不能直接给 exports 赋值，这会使得导出失效
2. commonjs 中模块只会被引入一次并被保存在内存中, 下面代码中 `node b.js` 只会输出一次 `"a"`

```js
// b.js
const { add } = require('./a');
add(2, 1);
const { sub } = require('./a');
sub(2, 1);

// a.js
console.log('a');
module.exports = {
  add: (a, b) => a + b,
  sub: (a, b) => a - b,
};
```

### commonjs 和 es6 模块的区别

1. commonjs 是运行时的，只有在运行之后才知道导入导出的是什么，require 内跟的可以是一个表达式
2. es6 是编译时的，在构建时就明确知道哪些模块会被引入，所以 import/export 只能写在模块的顶层作用域，不能写在类似 if 的语句中
3. commonjs 导出的是一个对象，es6 导出是变量，在编译器层面上更优
4. commonjs 导出的是值的一个拷贝，es6 导出的是值的一个映射, 下面`node b.js`输出 `a a b`

```js
// a.js
let a = 'a';

module.exports = {
  a,
  change(newA) {
    a = newA;
  },
  log() {
    console.log(a);
  },
};

// b.js
const { a, change, log } = require('./a');

console.log(a);
change('b');
console.log(a);
log();
```

改写成 es6 模块

```js
// a.js
export let a = 'a';
export function change(newA) {
  a = new A();
}
export function log() {
  console.log(a);
}

// b.js
import { a, change, log } from './a';
console.log(a);
change('b');
console.log(a);
log();
```
